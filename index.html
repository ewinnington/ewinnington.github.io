
<!DOCTYPE html>
<!--
	Phantom by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="en">

	<head>
		<title>Eric Winnington</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />		
        <link href="/assets/css/highlight.css" rel="stylesheet">
		<!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="/assets/css/main.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="/assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="/assets/css/ie8.css" /><![endif]-->
        <link href="/assets/css/override.css" rel="stylesheet" />

		<meta name="description" content="A collection of thoughts, code and snippets." />
		<link type="application/rss+xml" rel="alternate" title="Eric Winnington" href="/feed.rss" />
				<link type="application/atom+xml" rel="alternate" title="Eric Winnington" href="/feed.atom" />
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" href="/favicon.ico" type="image/x-icon">

		<meta name="application-name" content="Eric Winnington" />
		<meta name="msapplication-tooltip" content="Eric Winnington" />
		<meta name="msapplication-starturl" content="/" />

		<meta property="og:title" content="Eric Winnington" /> 
		<meta property="og:type" content="website" />
		<meta property="og:url" content="http://ewinnington.github.io/" />
		<!-- TODO: More social graph meta tags -->

        <script src="/assets/js/highlight.pack.js"></script>   
		
        <meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ewinnington" />
<meta name="twitter:title" content="Eric Winnington" />
<meta name="twitter:description" content="A collection of thoughts, code and snippets." />

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
		
	</head>

	<body>
		<!-- Wrapper -->
		<div id="wrapper">

			<!-- Header -->
			<header id="header">
				<div class="inner">

					<!-- Logo -->
					<a href="/" class="logo">
						<span class="title">Eric Winnington</span>
					</a>

					<!-- Nav -->
					<nav>
						<ul>
							<li><a href="#menu">Menu</a></li>
						</ul>
					</nav>

				</div>
			</header>

			<!-- Menu -->
			<nav id="menu">
				<h2>Menu</h2>
				<ul>
					        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About Me</a></li>
        <li><a href="/videos">Videos on programming</a></li>

				</ul>
			</nav>

			<!-- Main -->
			<div id="main">
				<div class="inner">

    <header>
        <h1>A collection of thoughts, code and snippets.</h1>
    </header>

					
					<div id="content">
						
<div class="row">
    <div class="8u 12u$(medium)">
                <div>
                    <a href="/posts/jupyter-lp-20">
                        <h2>Applications in LP and MILP with C# and OR-Tools inside Jupyter</h2>
                    </a>
                    <p>Posted on Saturday, 16 November 2019</p>
<p>Thanks to the integration of C# into <a href="https://jupyter.org/">Jupyter notebooks</a> with the <a href="https://github.com/dotnet/try">kernel from Donet try</a> and support from the <a href="https://mybinder.org/">MyBinder.org</a> hosting, it's easy to share with you runnable workbooks to illustrate how to use the <a href="https://developers.google.com/optimization">Google OR-Tools</a> to solve the <a href="https://en.wikipedia.org/wiki/Linear_programming">linear</a> (LP) and <a href="https://en.wikipedia.org/wiki/Integer_programming">mixed-integer linear problems</a> (MILP) .</p>
<h1 id="applications-of-linear-programming">Applications of linear programming</h1>
<h2 id="lp-problem-wire-production">LP Problem : Wire production</h2>
<p>A plant makes aluminium and copper wires. Each Kg of aluminium wire requires 10 kWh of electricity and <span class="math">\(\frac{1}{2}\)</span> hour of labour. Each Kg of Copper wire requires 4 kWh of electricity and $1$ hour of labour. Electricity is limited to 450 kWh/day, labour is limited to 42.5 hours/day at a cost of 11 € an hour, Electricity cost is 20 € / MWh, Aluminium cost is 1.8 €/Kg, Copper cost is 5.4 €/Kg. Total weight delivered to the plant daily is limited to 56 Kg. Aluminium wire sales price is 45 €/Kg, Copper wire sales price is 50 €/Kg.</p>
<p>What should be produced to maximise profit and what is the maximum profit?</p>
<p><a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=Lp_WireProduction.ipynb">Launch the binder</a>  <a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=Lp_WireProduction.ipynb"><img src="https://mybinder.org/badge_logo.svg" class="img-fluid" alt="Binder" /></a></p>
<pre><code class="language-CSharp">Solver solver = Solver.CreateSolver(&quot;LinearProgramming&quot;, &quot;CLP_LINEAR_PROGRAMMING&quot;);

//Setting up the variables and constants of the problem 
Variable Al = solver.MakeNumVar(0.0, double.PositiveInfinity, &quot;Al&quot;);
Variable Cu = solver.MakeNumVar(0.0, double.PositiveInfinity, &quot;Cu&quot;);
double El_Price = 20.0; double El_Max = 450; 
double La_Price = 11.0; double La_Max = 42.5; 
double Weight_Max = 56.0; 
double Al_Purchase = 1.8 ; double Al_Sale = 45.0;
double Cu_Purchase = 5.4; double Cu_Sale = 50.0;

// Maximize revenue 
Objective objective = solver.Objective();
objective.SetCoefficient(Al, Al_Sale-Al_Purchase-(La_Price * 1/2.0)-(El_Price * 10/1000.0));
objective.SetCoefficient(Cu, Cu_Sale-Cu_Purchase-(La_Price * 1)-(El_Price * 4/1000.0));
objective.SetMaximization();

// Electricity usage limit
Constraint c0 = solver.MakeConstraint(0, El_Max);
c0.SetCoefficient(Al, 10);
c0.SetCoefficient(Cu, 4);

// Labour usage limit
Constraint c1 = solver.MakeConstraint(0, La_Max);
c1.SetCoefficient(Al, 1/2.0);
c1.SetCoefficient(Cu, 1);

// Weight limit
Constraint c2 = solver.MakeConstraint(0, Weight_Max);
c2.SetCoefficient(Al, 1);
c2.SetCoefficient(Cu, 1);

SolveAndPrint(solver);
</code></pre>
<h2 id="milp-problem-knapsack">MILP Problem : Knapsack</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Knapsack_problem">knapsack problem</a> defines a bag that was a maximal weight of <span class="math">\(W\)</span>, we can take items from a set of items each with a weight of <span class="math">\(w_i\)</span> and a value of <span class="math">\(v_i\)</span>. Typically, the problem is defined with an <span class="math">\(x_i \in \{0,1\}\)</span> variable set to either 0 or 1 knapsack where each item is either taken or not.</p>
<p>Here we are going to allow fractional parts of the items to be taken so that we can solve it as a linear problem (also known as a linear relaxation), allowing <span class="math">\(x_i \in [0,1]\)</span>.</p>
<p><a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=Knapsack_Lp_Milp.ipynb">Launch the binder</a>  <a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=Knapsack_Lp_Milp.ipynb"><img src="https://mybinder.org/badge_logo.svg" class="img-fluid" alt="Binder" /></a></p>
<pre><code class="language-CSharp">//Array of items, weights and totals
int nItems = 10; 
double maxWeight = 220; 
double[] weights = {31, 27, 12, 39,  2, 69, 66, 29, 45, 58};
double[] values =  {24, 27, 26, 15, 19, 33, 30, 28, 65, 42};

Solver milp_solver = Solver.CreateSolver(&quot;MILP&quot;, &quot;CBC_MIXED_INTEGER_PROGRAMMING&quot;);

Variable[] Items = milp_solver.MakeBoolVarArray(10, &quot;Items&quot;);

// Maximize revenue 
Objective objective = milp_solver.Objective();
for(int i = 0; i &lt; nItems; i++) objective.SetCoefficient(Items[i], values[i]);
objective.SetMaximization();

// Weight limit
Constraint c0 = milp_solver.MakeConstraint(0, maxWeight);
for(int i = 0; i &lt; nItems; i++) c0.SetCoefficient(Items[i], weights[i]);

SolveAndPrint(milp_solver, nItems, weights);
</code></pre>
<p>There are many ways of solving the knapsack problem, using LP and MILP solvers as seen here or using Dynamic Programming. The Google OR-Tools have a specific solver for multi-dimensional knapsack problems, including one which uses Dynamic Programming.</p>
                </div>       
                <div>
                    <a href="/posts/my-binder-jupyter-csharp">
                        <h2>Hosting your C# Jupyter notebook online by adding one file to your repo</h2>
                    </a>
                    <p>Posted on Thursday, 14 November 2019</p>
<p><a href="https://mybinder.org/">MyBinder.org</a> in collaboration with <a href="https://github.com/dotnet/try">Dotnet try</a> allows you to host your .net notebooks online.</p>
<p><a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=SqliteInteraction.ipynb">SQLite example workbook: </a>
<a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=SqliteInteraction.ipynb"><img src="https://mybinder.org/badge_logo.svg" class="img-fluid" alt="Binder" /></a></p>
<p>To light up this for your own hosted repositories, you will need a public github repo. Inside the repository, you will need to create a Docker file that gives the setup required for MyBinder to setup the environment of the workbook.</p>
<p>The <a href="https://github.com/dotnet/try/blob/master/CreateBinder.md">dotnet/try</a> has the set of instrunctions.</p>
<p>For my repository, I used the following <a href="https://github.com/ewinnington/noteb/blob/master/Dockerfile">Dockerfile</a></p>
<p>A list of my changes to the standard one proposed by dotnet/try:</p>
<ul>
<li>I used a fixed docker image <code>jupyter/scipy-notebook:45f07a14b422</code></li>
<li>Since I have all my notebooks in the root of my repository I did <code>COPY . ${HOME}/Notebooks/</code></li>
<li>Since I am always importing the Nuget files at the top of my workbook, I did not need to have the docker deamon add a nuget config. So I commented out the COPY command <code># COPY ./NuGet.config ${HOME}/nuget.config</code></li>
<li>I commented out the custom <code>--add-source &quot;https://dotnet.myget.org/F/dotnet-try/api/v3/index.json&quot;</code> from the installation of the dotnet try tool, since I had issue with the nuget feed with the pre-release version. Installing with <code>RUN dotnet tool install -g dotnet-try</code> will get you the latest released version.</li>
</ul>
<pre><code class="language-Skip">FROM jupyter/scipy-notebook:45f07a14b422

# Install .NET CLI dependencies

ARG NB_USER=jovyan
ARG NB_UID=1000
ENV USER ${NB_USER}
ENV NB_UID ${NB_UID}
ENV HOME /home/${NB_USER}

WORKDIR ${HOME}

USER root
RUN apt-get update
RUN apt-get install -y curl

# Install .NET CLI dependencies
RUN apt-get install -y --no-install-recommends \
        libc6 \
        libgcc1 \
        libgssapi-krb5-2 \
        libicu60 \
        libssl1.1 \
        libstdc++6 \
        zlib1g 

RUN rm -rf /var/lib/apt/lists/*

# Install .NET Core SDK
ENV DOTNET_SDK_VERSION 3.0.100

RUN curl -SL --output dotnet.tar.gz https://dotnetcli.blob.core.windows.net/dotnet/Sdk/$DOTNET_SDK_VERSION/dotnet-sdk-$DOTNET_SDK_VERSION-linux-x64.tar.gz \
    &amp;&amp; dotnet_sha512='766da31f9a0bcfbf0f12c91ea68354eb509ac2111879d55b656f19299c6ea1c005d31460dac7c2a4ef82b3edfea30232c82ba301fb52c0ff268d3e3a1b73d8f7' \
    &amp;&amp; echo &quot;$dotnet_sha512 dotnet.tar.gz&quot; | sha512sum -c - \
    &amp;&amp; mkdir -p /usr/share/dotnet \
    &amp;&amp; tar -zxf dotnet.tar.gz -C /usr/share/dotnet \
    &amp;&amp; rm dotnet.tar.gz \
    &amp;&amp; ln -s /usr/share/dotnet/dotnet /usr/bin/dotnet

# Enable detection of running in a container
ENV DOTNET_RUNNING_IN_CONTAINER=true \
    # Enable correct mode for dotnet watch (only mode supported in a container)
    DOTNET_USE_POLLING_FILE_WATCHER=true \
    # Skip extraction of XML docs - generally not useful within an image/container - helps performance
    NUGET_XMLDOC_MODE=skip \
    # Opt out of telemetry until after we install jupyter when building the image, this prevents caching of machine id
    DOTNET_TRY_CLI_TELEMETRY_OPTOUT=true

# Trigger first run experience by running arbitrary cmd
RUN dotnet help

# Copy notebooks

COPY . ${HOME}/Notebooks/

# Copy package sources

# COPY ./NuGet.config ${HOME}/nuget.config

RUN chown -R ${NB_UID} ${HOME}
USER ${USER}

# Install Microsoft.DotNet.Interactive
RUN dotnet tool install -g dotnet-try 
#--add-source &quot;https://dotnet.myget.org/F/dotnet-try/api/v3/index.json&quot;

ENV PATH=&quot;${PATH}:${HOME}/.dotnet/tools&quot;
RUN echo &quot;$PATH&quot;

# Install kernel specs
RUN dotnet try jupyter install

# Enable telemetry once we install jupyter for the image
ENV DOTNET_TRY_CLI_TELEMETRY_OPTOUT=false

# Set root to Notebooks
WORKDIR ${HOME}/Notebooks/
</code></pre>
<p>Once the Dockerfile is in the repository. Head over to <a href="https://mybinder.org/">MyBinder.org</a> and enter the link to your repository. Optionally, you can set an initial ipynb file to start when the link is clicked.</p>
<p><img src="/posts/images/my-binder/Binder-1.png" class="img-fluid" alt="MyBinder" /></p>
<p>When you click &quot;launch&quot;, MyBinder will download your repository and start the docker build, very soon you will be able to access your binders online. Fully shareable and totally awesome!</p>
<p><img src="/posts/images/my-binder/Binder-2.png" class="img-fluid" width="60%" alt="SQLite Running" /></p>
                </div>       
                <div>
                    <a href="/posts/jupyter-lp-10">
                        <h2>Introduction to linear programming with C# and OR-Tools inside Jupyter</h2>
                    </a>
                    <p>Posted on Thursday, 14 November 2019</p>
<p><a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=IntroToLP.ipynb"><img src="https://mybinder.org/badge_logo.svg" class="img-fluid" alt="Binder" /></a></p>
<h1 id="linear-programming">Linear programming</h1>
<p><a href="https://en.wikipedia.org/wiki/Linear_programming">Linear programming</a> (LP) is a method to provide an optimal solution to a problem defined by a set of linear constraints. It is very widely applied in engineering and science.</p>
<p>A typical linear programming problem is defined by an Objective function (the target to maximise or minimise) and a set of constraints which limit the solution space.</p>
<h2 id="what-does-an-lp-problem-look-like">What does an LP problem look like?</h2>
<p>We are going to start with a very simple linear problem definition. The first line of the problem describes the objective function, in this the value to maximize. In this problem, we have two variables to optimize x and y. The constraints that limit the problem's space are defined under the subject to section.</p>
<div class="math">
\[
\begin{aligned}
\max (2y+x) \\
\text{subject to:} \\
\qquad x \leq 15 \\
\qquad y \leq 8 
\end{aligned}
\]</div>
<p>This very simple maximisation problem has a maximum solution of <span class="math">\(x=15\)</span> and <span class="math">\(y=8\)</span> for an objective value of <span class="math">\(31\)</span> .</p>
<p><img src="/posts/images/lp/A1.png" class="img-fluid" width="100%" alt="A1" /></p>
<p>There exist many linear programming solvers to calculate this optimum. We will be using <a href="https://github.com/coin-or/Clp">Coin-OR project CLP</a> with the <a href="https://developers.google.com/optimization">Google OR-Tools</a> as an interface for C#.</p>
<h2 id="meet-the-solver">Meet the solver</h2>
<p>You can find my <a href="https://github.com/ewinnington/noteb/blob/master/IntroToLP.ipynb">notebook with all the code here</a>. And you can now access the <a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=IntroToLP.ipynb">Jupyter notebooks online, thanks to Binder</a>!</p>
<h3 id="coin-or-clp-with-google-or-tools">Coin-OR<a id="fnref:1" href="#fn:1" class="footnote-ref"><sup>1</sup></a> CLP (with Google OR<a id="fnref:2" href="#fn:1" class="footnote-ref"><sup>1</sup></a>-Tools)</h3>
<p>The <a href="https://www.coin-or.org">Coin-OR project</a> provides high quality solvers for many applications with an open source license. <a href="https://github.com/coin-or/Clp">CLP</a> is the main linear programming solver we will be using until we start adding binary variables, at which point we will start using <a href="https://github.com/coin-or/Cbc">CBC</a>. To call them from C#, we could write out a format that CLP / CBC knows how to read, such as <a href="https://en.wikipedia.org/wiki/MPS_(format)">MPS</a> or we could use a wrapping library to call them directly from C#. We will be focusing on using the Google OR-Tools.</p>
<h4 id="google-or-tools">Google OR-Tools</h4>
<p>The <a href="https://developers.google.com/optimization/">Google OR-Tools</a> provide us with a set of primitives with which to work with so that we can define optimisation problems and allow us to call to various solvers, including CLP, which we will be using. Also the OR-Tools provide routines to write out the problems in MPS and other formats. We will focus on using the OR Tools as soon as the introduction is over.</p>
<p>Adding the Google OR Tools through nuget to the Jupyter notebook with the <code>#r</code> command and <code>using</code> in the cell imports the solver.</p>
<pre><code class="language-CSharp">#r &quot;nuget:Google.OrTools&quot;

using Google.OrTools.LinearSolver;
</code></pre>
<p><img src="/posts/images/lp/10-1.png" class="img-fluid" alt="10-1.png" /></p>
<p>This allows us to create a solver instance as follows, note the constant <code>CLP_LINEAR_PROGRAMMING</code> this tells us which solver we will be using.</p>
<pre><code class="language-CSharp">Solver solver = Solver.CreateSolver(&quot;LinearProgramming&quot;, &quot;CLP_LINEAR_PROGRAMMING&quot;);
</code></pre>
<p>The following code snippet implements the linear program formulation below<a id="fnref:3" href="#fn:2" class="footnote-ref"><sup>2</sup></a>:</p>
<div class="math">
\[
\begin{aligned}
\max (2y+x) \\
\text{subject to:} \\
\qquad x \leq 15 \\
\qquad y \leq 8 
\end{aligned}
\]</div>
<p>The solver has been already defined and initalized. We are now defining the variables of the problem, the objective function and the linear constraints that apply.</p>
<pre><code class="language-CSharp">Variable x = solver.MakeNumVar(0.0, double.PositiveInfinity, &quot;x&quot;);
Variable y = solver.MakeNumVar(0.0, double.PositiveInfinity, &quot;y&quot;);

// Maximize 2*y+x.
Objective objective = solver.Objective();
objective.SetCoefficient(x, 1);
objective.SetCoefficient(y, 2);
objective.SetMaximization();

// 0 &lt;= x &lt;= 15 
Constraint c0 = solver.MakeConstraint(0, 15);
c0.SetCoefficient(x, 1);

// 0 &lt;= y &lt;= 8
Constraint c1 = solver.MakeConstraint(0, 8);
c1.SetCoefficient(y, 1);
</code></pre>
<p><img src="/posts/images/lp/10-2.png" class="img-fluid" alt="10-2.png" /></p>
<p>When you execute the next cells, the solver.Solve() function is called and the results will be written out to the cell's output. We will use this function cell several times over the course of the workbook.</p>
<pre><code class="language-CSharp">public void SolveProblem() {
    var resultStatus = solver.Solve();

    // Check that the problem has an optimal solution.
    if (resultStatus != Solver.ResultStatus.OPTIMAL)
    {
        Console.WriteLine(&quot;The problem does not have an optimal solution!&quot;);
        return;
    }

    Console.WriteLine(&quot;Problem solved in &quot; + solver.WallTime() + &quot; milliseconds&quot;);

    // The objective value of the solution.
    Console.WriteLine(&quot;Optimal objective value = &quot; + solver.Objective().Value());

    // The value of each variable in the solution.
    foreach (var v in solver.variables())
    { Console.WriteLine($&quot;{v.Name()} : {v.SolutionValue()} &quot;); };
}
</code></pre>
<p><img src="/posts/images/lp/10-3.png" class="img-fluid" alt="10-3.png" /></p>
<h3 id="other-solvers">Other solvers</h3>
<p>There exists many other solvers that are available, either directly wrapped through the Google OR Tools such as GLOP or another library or as external programs fed through input files in MPS or other formats. The <a href="https://neos-server.org/neos/">NEOS project</a> provides a thorough set of optimisation solvers that are available online with many input formats available (MPS, AMPL, Lp, GAMS).</p>
<h2 id="problem-2">Problem 2</h2>
<p>We will be adding a third constraint to the formulation of Problem 1.</p>
<div class="math">
\[
\begin{aligned}
\text{Obj:} \max(2y+x)
\\ \text{subject to:} \quad x \leq 15
\\ \qquad \quad \quad \quad y \leq 8
\\ \quad \quad \quad x+y \leq 18
\end{aligned}
\]</div>
<p><img src="/posts/images/lp/A2.png" class="img-fluid" width="100%" alt="A2" /></p>
<p>The solver is initialized with the full problem 1 defintion already, x and y are already declared. When you click run on the solver's cell, the solver.Solve() function is called and results are written out.</p>
<pre><code class="language-CSharp">Constraint c = solver.MakeConstraint(0, 18);
c.SetCoefficient(x, 1);
c.SetCoefficient(y, 1);
</code></pre>
<p>If you call <code>SolveProblem();</code>, you will now have a new optimal value that is lower that the previous one. In linear programming maximization problem, adding a new constraint will always make the optimal value lower or equal to the less constrained. problem</p>
<p><img src="/posts/images/lp/10-4.png" class="img-fluid" alt="10-4.png" /></p>
<h2 id="problem-3">Problem 3</h2>
<p>You should now be able to add an adding a fourth constraint to the formulation of Problem 2.</p>
<div class="math">
\[
\begin{aligned}
\text{Obj:} \max(2y+x)
\\ \text{subject to:} \qquad x \leq 15
\\ \qquad \quad y \leq 8
\\ \quad x+y \leq 18
\\ -\frac{1}{3}x+y \leq 2
\end{aligned}
\]</div>
<p><img src="/posts/images/lp/A3.png" class="img-fluid" width="100%" alt="A3" /></p>
<p>The solver is initialized with the full problem 2 defintion already, x and y are already declared. When you click on the solver's cell, the solver.Solve() function is called and results are written out.</p>
<p><img src="/posts/images/lp/10-5.png" class="img-fluid" width="100%" alt="10-5.png" /></p>
<p>For those following along in the <a href="https://github.com/ewinnington/noteb/blob/master/IntroToLP.ipynb">notebook</a> there is a hint below this section with a second implementation of the <code>SolveProblem()</code> function which should give you hints based on your objective value.</p>
<h2 id="the-power-of-jupyter-special-commands">The power of Jupyter special commands</h2>
<p>I'm discovering slowly the jupyter commands. The first command <code>display()</code> allows you to present objects in a table. A great way to select the properties you want to show is to use linq (remember to add <code>using System.Linq</code>) to map a list of objects to an anonymous object with the properties you want to show in the table.</p>
<pre><code>display(solver.variables().Select(a =&gt; new { Name  = a.Name(), Value = a.SolutionValue() }));
</code></pre>
<p><img src="/posts/images/lp/10-6.png" class="img-fluid" width="100%" alt="10-6.png" /></p>
<h2 id="recap">Recap</h2>
<p>Now that we have introduced linear programming and know how to use the solver, the following chapter will cover two simple linear programming applications.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn:1">
<p>OR here refers to <a href="https://en.wikipedia.org/wiki/Operations_research">Operational Research</a> - the field of mathematics dedicated to the search for optimal or near optimal solutions to problems.<a href="#fnref:1" class="footnote-back-ref">&#8617;</a><a href="#fnref:2" class="footnote-back-ref">&#8617;</a></p>
</li>
<li id="fn:2">
<p>For those using <a href="/posts/Switching-to-wyam">Wyam to generate their blogs</a>, you can add the</p>
<pre><code class="language-HTML">&lt;script type=&quot;text/javascript&quot; id=&quot;MathJax-script&quot; async
src=&quot;https://cdn.jsdelivr.net/npm/mathjax&#64;3/es5/tex-mml-chtml.js&quot;&gt;
&lt;/script&gt;
</code></pre>
<p>to your <code>_Head.cshtml</code> template page. I recommend checking out <a href="https://www.mathjax.org/">MathJax</a> for the latest <a href="http://docs.mathjax.org/en/latest/web/start.html#using-mathjax-from-a-content-delivery-network-cdn">CDN</a>.<a href="#fnref:3" class="footnote-back-ref">&#8617;</a></p>
</li>
</ol>
</div>
                </div>       
                <div>
                    <a href="/posts/jupyter-docker-csharp-postgres">
                        <h2>Docker controlled from Jupyter Notebook C# with PostgresDB</h2>
                    </a>
                    <p>Posted on Tuesday, 12 November 2019</p>
<p>In the context of Docker and Jupyter Notebook, it's interesting to note that there exists a Nuget that allows C# to control docker. So, yes, it is possible to launch a Postgresql database, on docker, inside a Jupyter notebook!</p>
<p>This assumes you have <a href="https://hub.docker.com/?overlay=onboarding">Docker</a>, <a href="https://github.com/dotnet/try/blob/master/DotNetTryLocal.md">Dotnet try</a>, <a href="https://jupyter.org/">Jupyter notebook</a> and follow the setup of the <a href="/posts/jupyter-notebook-csharp-r">C# kernel for Jupyter</a>.</p>
<p>If you don't want to wait, you can find my <a href="https://github.com/ewinnington/noteb/blob/master/DockerInteraction.ipynb">complete notebook here</a>.</p>
<p>Microsoft has created a <a href="https://github.com/microsoft/Docker.DotNet">C# Client library for talking to Docker</a>, so we will be taking advantage of it. Much of the magic docker code is pulled from the Docker.DotNet repository.
I'm using the <a href="https://www.npgsql.org/index.html">Npgsql drivers</a> for accessing the PostgreSQL database.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-01.png" class="img-fluid" alt="pgsql01" /></p>
<p>The real magic moment is when you access the Docker instance, if it is on your local machine on windows, you can use the <code>npipe://./pipe/docker_engine</code> Uri. If you are on Linux, use <code>unix:///var/run/docker.sock</code> (at this time, I haven't tried it on linux, but if you do, please tell me).
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-02.png" class="img-fluid" alt="pgsql02" /></p>
<p>In block 3, we select a random port to host the pgSQL database. Then list the local image names that are available (you should get postgres:latest on your machine to run this). We create and start up the container, passing the environment variables for the password, user and initial schema. Once the container is started, we detach ourselves from it, so it runs in the background. Finally, I wait until I'm pretty sure the container and database is ready (10s sleep at the end). You can reduce that sleep time. On my Surface laptop 1, I sometimes have an issue when I've got too many other containers running.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-03.png" class="img-fluid" alt="pgsql03" /></p>
<p>I'm connecting to the database and validating the connection name.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-04.png" class="img-fluid" alt="pgsql04" /></p>
<p>I'm creating a database schema and a user for this particular schema, then reconning with the new user.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-05.png" class="img-fluid" alt="pgsql05" /></p>
<p>Creating a table and inserting two rows using direct strings and string concatenation. In production, you should never be using string concatenation for your SQL statements. Please always use Bound variables as described below.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-06.png" class="img-fluid" alt="pgsql06" /></p>
<p>This is how you should interact with the PostgreSQL database if you are using direct SQL statements. You should be using Bound commands with parameters.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-07.png" class="img-fluid" alt="pgsql07" /></p>
<p>Finally, I check that all three insertions were successful.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-08.png" class="img-fluid" alt="pgsql08" /></p>
<p>You can watch the container run in the <a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker">docker extension</a> of <a href="https://code.visualstudio.com/">Visual studio Code</a>. It's a great way of monitoring what is currently running, as well as deleting old containers that might be still present.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-10.png" class="img-fluid" alt="pgsql10" /></p>
<p>Talking of deleting old containers, this is how you shut them down and delete them at the end of the notebook. I first close the Db connection and dispose of it before asking Docker.DotNet to stop the containers.
<img src="/posts/images/jupyter-notebook-csharp-r/docker-pg-09.png" class="img-fluid" alt="pgsql09" /></p>
<p>It would be cleaner if I knew how to enfore a <code>Finally</code> in Jupyter Notebook, but at this time, I don't know. If you do, drop me a line on <a href="https://twitter.com/ThrowATwit">twitter</a> or a pull request on this blog post.</p>
                </div>       
        <ul class="pager">
            <li class="previous">                
            </li>
            <li class="next">
            </li>
        </ul>
    </div>
    <div class="4u 12u$(medium)">

            <h5>Tags</h5>
            <ul class="actions small">
                    <li><a role="button" href="/tags/Migrated" class="button small">Migrated (38)</a></li>
                    <li><a role="button" href="/tags/CSharp" class="button small">CSharp (7)</a></li>
                    <li><a role="button" href="/tags/Dotnet-try" class="button small">Dotnet try (6)</a></li>
                    <li><a role="button" href="/tags/Jupyter-notebook" class="button small">Jupyter notebook (6)</a></li>
                    <li><a role="button" href="/tags/Rpi" class="button small">Rpi (4)</a></li>
                    <li><a role="button" href="/tags/Oracle" class="button small">Oracle (4)</a></li>
                    <li><a role="button" href="/tags/CommandLine" class="button small">CommandLine (4)</a></li>
                    <li><a role="button" href="/tags/WPF" class="button small">WPF (4)</a></li>
                    <li><a role="button" href="/tags/OSX" class="button small">OSX (3)</a></li>
                    <li><a role="button" href="/tags/iOS" class="button small">iOS (3)</a></li>
            </ul>
            <ul class="actions small">
                <li><a href="/tags" class="button small">View All Tags &rarr;</a></li>
            </ul>    

            <h5>Older Posts</h5>
            <ul>
                    <li><a href="/posts/jupyter-sqlite-csharp">Testing SQLite in C# Jupyter notebook</a></li>
                    <li><a href="/posts/jupyter-notebook-csharp-r">Jupyter notebook with C# and R</a></li>
                    <li><a href="/posts/bulk-inserts">Using bulk inserts on databases</a></li>
                    <li><a href="/posts/webassembly-thoughts">Reflections on Webassembly - May/Nov 19</a></li>
            </ul>
                <ul class="actions small">
                    <li><a href="/posts" class="button small">Archive &rarr;</a></li>
                </ul>

        
    </div> 
</div>

					</div>
				</div>
			</div>

			<!-- Footer -->
			<footer id="footer">
				<div class="inner">
    <section>
        <h2>Feeds</h2>
        <ul class="actions small vertical">
            <li><a href="/feed.rss" class="button small"><i class="fa fa-rss"></i> RSS Feed</a></li>
                        <li><a href="/feed.atom" class="button small"><i class="fa fa-rss"></i> Atom Feed</a></li>
        </ul>
    </section>
    <section>
    </section>
    <ul class="copyright">
        <li>Copyright © 2019</li>
        <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
        <li><a href="https://wyam.io">Generated by Wyam</a></li>
    </ul>
</div>

			</footer>

		</div>
		
		

		<!-- Scripts -->
		<script>hljs.initHighlightingOnLoad();</script>
		<script src="/assets/js/jquery.min.js"></script>
		<script src="/assets/js/skel.min.js"></script>
		<script src="/assets/js/util.js"></script>
		<!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
		<script src="/assets/js/main.js"></script>

	</body>

</html>
