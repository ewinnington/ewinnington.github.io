
<!DOCTYPE html>
<!--
	Phantom by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="en">

	<head>
		<title>Eric Winnington - Introduction to linear programming with C# and OR-Tools inside Jupyter</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />		
        <link href="/assets/css/highlight.css" rel="stylesheet">
		<!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="/assets/css/main.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="/assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="/assets/css/ie8.css" /><![endif]-->
        <link href="/assets/css/override.css" rel="stylesheet" />

		<meta name="description" content="A collection of thoughts, code and snippets." />
		<link type="application/rss+xml" rel="alternate" title="Eric Winnington" href="/feed.rss" />
				<link type="application/atom+xml" rel="alternate" title="Eric Winnington" href="/feed.atom" />
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" href="/favicon.ico" type="image/x-icon">

		<meta name="application-name" content="Eric Winnington" />
		<meta name="msapplication-tooltip" content="Eric Winnington" />
		<meta name="msapplication-starturl" content="/" />

		<meta property="og:title" content="Eric Winnington - Introduction to linear programming with C# and OR-Tools inside Jupyter" /> 
		<meta property="og:type" content="website" />
		<meta property="og:url" content="http://ewinnington.github.io/posts/jupyter-lp-10" />
		<!-- TODO: More social graph meta tags -->

        <script src="/assets/js/highlight.pack.js"></script>   
		
        <meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ewinnington" />
<meta name="twitter:title" content="Eric Winnington - Introduction to linear programming with C# and OR-Tools inside Jupyter" />
<meta name="twitter:description" content="A collection of thoughts, code and snippets." />

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
		
	</head>

	<body>
		<!-- Wrapper -->
		<div id="wrapper">

			<!-- Header -->
			<header id="header">
				<div class="inner">

					<!-- Logo -->
					<a href="/" class="logo">
						<span class="title">Eric Winnington</span>
					</a>

					<!-- Nav -->
					<nav>
						<ul>
							<li><a href="#menu">Menu</a></li>
						</ul>
					</nav>

				</div>
			</header>

			<!-- Menu -->
			<nav id="menu">
				<h2>Menu</h2>
				<ul>
					        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About Me</a></li>
        <li><a href="/videos">Videos on programming</a></li>

				</ul>
			</nav>

			<!-- Main -->
			<div id="main">
				<div class="inner">

    
<header>
    <h1>Introduction to linear programming with C# and OR-Tools inside Jupyter</h1>
            <p><em>Published on Thursday, 14 November 2019</em></p>
            <ul class="actions small">
                    <li><a role="button" href="/tags/CSharp" class="button small">CSharp</a></li>
                    <li><a role="button" href="/tags/Dotnet-try" class="button small">Dotnet try</a></li>
                    <li><a role="button" href="/tags/Google-OR-Tools" class="button small">Google OR-Tools</a></li>
                    <li><a role="button" href="/tags/Jupyter-notebook" class="button small">Jupyter notebook</a></li>
                    <li><a role="button" href="/tags/LinearProgramming" class="button small">LinearProgramming</a></li>
        </ul>     
</header>

					
					<div id="content">
						

<p><a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=IntroToLP.ipynb"><img src="https://mybinder.org/badge_logo.svg" class="img-fluid" alt="Binder" /></a></p>
<h1 id="linear-programming">Linear programming</h1>
<p><a href="https://en.wikipedia.org/wiki/Linear_programming">Linear programming</a> (LP) is a method to provide an optimal solution to a problem defined by a set of linear constraints. It is very widely applied in engineering and science.</p>
<p>A typical linear programming problem is defined by an Objective function (the target to maximise or minimise) and a set of constraints which limit the solution space.</p>
<h2 id="what-does-an-lp-problem-look-like">What does an LP problem look like?</h2>
<p>We are going to start with a very simple linear problem definition. The first line of the problem describes the objective function, in this the value to maximize. In this problem, we have two variables to optimize x and y. The constraints that limit the problem's space are defined under the subject to section.</p>
<div class="math">
\[
\begin{aligned}
\max (2y+x) \\
\text{subject to:} \\
\qquad x \leq 15 \\
\qquad y \leq 8 
\end{aligned}
\]</div>
<p>This very simple maximisation problem has a maximum solution of <span class="math">\(x=15\)</span> and <span class="math">\(y=8\)</span> for an objective value of <span class="math">\(31\)</span> .</p>
<p><img src="/posts/images/lp/A1.png" class="img-fluid" width="100%" alt="A1" /></p>
<p>There exist many linear programming solvers to calculate this optimum. We will be using <a href="https://github.com/coin-or/Clp">Coin-OR project CLP</a> with the <a href="https://developers.google.com/optimization">Google OR-Tools</a> as an interface for C#.</p>
<h2 id="meet-the-solver">Meet the solver</h2>
<p>You can find my <a href="https://github.com/ewinnington/noteb/blob/master/IntroToLP.ipynb">notebook with all the code here</a>. And you can now access the <a href="https://mybinder.org/v2/gh/ewinnington/noteb/master?filepath=IntroToLP.ipynb">Jupyter notebooks online, thanks to Binder</a>!</p>
<h3 id="coin-or-clp-with-google-or-tools">Coin-OR<a id="fnref:1" href="#fn:1" class="footnote-ref"><sup>1</sup></a> CLP (with Google OR<a id="fnref:2" href="#fn:1" class="footnote-ref"><sup>1</sup></a>-Tools)</h3>
<p>The <a href="https://www.coin-or.org">Coin-OR project</a> provides high quality solvers for many applications with an open source license. <a href="https://github.com/coin-or/Clp">CLP</a> is the main linear programming solver we will be using until we start adding binary variables, at which point we will start using <a href="https://github.com/coin-or/Cbc">CBC</a>. To call them from C#, we could write out a format that CLP / CBC knows how to read, such as <a href="https://en.wikipedia.org/wiki/MPS_(format)">MPS</a> or we could use a wrapping library to call them directly from C#. We will be focusing on using the Google OR-Tools.</p>
<h4 id="google-or-tools">Google OR-Tools</h4>
<p>The <a href="https://developers.google.com/optimization/">Google OR-Tools</a> provide us with a set of primitives with which to work with so that we can define optimisation problems and allow us to call to various solvers, including CLP, which we will be using. Also the OR-Tools provide routines to write out the problems in MPS and other formats. We will focus on using the OR Tools as soon as the introduction is over.</p>
<p>Adding the Google OR Tools through nuget to the Jupyter notebook with the <code>#r</code> command and <code>using</code> in the cell imports the solver.</p>
<pre><code class="language-CSharp">#r &quot;nuget:Google.OrTools&quot;

using Google.OrTools.LinearSolver;
</code></pre>
<p><img src="/posts/images/lp/10-1.png" class="img-fluid" alt="10-1.png" /></p>
<p>This allows us to create a solver instance as follows, note the constant <code>CLP_LINEAR_PROGRAMMING</code> this tells us which solver we will be using.</p>
<pre><code class="language-CSharp">Solver solver = Solver.CreateSolver(&quot;LinearProgramming&quot;, &quot;CLP_LINEAR_PROGRAMMING&quot;);
</code></pre>
<p>The following code snippet implements the linear program formulation below<a id="fnref:3" href="#fn:2" class="footnote-ref"><sup>2</sup></a>:</p>
<div class="math">
\[
\begin{aligned}
\max (2y+x) \\
\text{subject to:} \\
\qquad x \leq 15 \\
\qquad y \leq 8 
\end{aligned}
\]</div>
<p>The solver has been already defined and initalized. We are now defining the variables of the problem, the objective function and the linear constraints that apply.</p>
<pre><code class="language-CSharp">Variable x = solver.MakeNumVar(0.0, double.PositiveInfinity, &quot;x&quot;);
Variable y = solver.MakeNumVar(0.0, double.PositiveInfinity, &quot;y&quot;);

// Maximize 2*y+x.
Objective objective = solver.Objective();
objective.SetCoefficient(x, 1);
objective.SetCoefficient(y, 2);
objective.SetMaximization();

// 0 &lt;= x &lt;= 15 
Constraint c0 = solver.MakeConstraint(0, 15);
c0.SetCoefficient(x, 1);

// 0 &lt;= y &lt;= 8
Constraint c1 = solver.MakeConstraint(0, 8);
c1.SetCoefficient(y, 1);
</code></pre>
<p><img src="/posts/images/lp/10-2.png" class="img-fluid" alt="10-2.png" /></p>
<p>When you execute the next cells, the solver.Solve() function is called and the results will be written out to the cell's output. We will use this function cell several times over the course of the workbook.</p>
<pre><code class="language-CSharp">public void SolveProblem() {
    var resultStatus = solver.Solve();

    // Check that the problem has an optimal solution.
    if (resultStatus != Solver.ResultStatus.OPTIMAL)
    {
        Console.WriteLine(&quot;The problem does not have an optimal solution!&quot;);
        return;
    }

    Console.WriteLine(&quot;Problem solved in &quot; + solver.WallTime() + &quot; milliseconds&quot;);

    // The objective value of the solution.
    Console.WriteLine(&quot;Optimal objective value = &quot; + solver.Objective().Value());

    // The value of each variable in the solution.
    foreach (var v in solver.variables())
    { Console.WriteLine($&quot;{v.Name()} : {v.SolutionValue()} &quot;); };
}
</code></pre>
<p><img src="/posts/images/lp/10-3.png" class="img-fluid" alt="10-3.png" /></p>
<h3 id="other-solvers">Other solvers</h3>
<p>There exists many other solvers that are available, either directly wrapped through the Google OR Tools such as GLOP or another library or as external programs fed through input files in MPS or other formats. The <a href="https://neos-server.org/neos/">NEOS project</a> provides a thorough set of optimisation solvers that are available online with many input formats available (MPS, AMPL, Lp, GAMS).</p>
<h2 id="problem-2">Problem 2</h2>
<p>We will be adding a third constraint to the formulation of Problem 1.</p>
<div class="math">
\[
\begin{aligned}
\text{Obj:} \max(2y+x)
\\ \text{subject to:} \quad x \leq 15
\\ \qquad \quad \quad \quad y \leq 8
\\ \quad \quad \quad x+y \leq 18
\end{aligned}
\]</div>
<p><img src="/posts/images/lp/A2.png" class="img-fluid" width="100%" alt="A2" /></p>
<p>The solver is initialized with the full problem 1 defintion already, x and y are already declared. When you click run on the solver's cell, the solver.Solve() function is called and results are written out.</p>
<pre><code class="language-CSharp">Constraint c = solver.MakeConstraint(0, 18);
c.SetCoefficient(x, 1);
c.SetCoefficient(y, 1);
</code></pre>
<p>If you call <code>SolveProblem();</code>, you will now have a new optimal value that is lower that the previous one. In linear programming maximization problem, adding a new constraint will always make the optimal value lower or equal to the less constrained. problem</p>
<p><img src="/posts/images/lp/10-4.png" class="img-fluid" alt="10-4.png" /></p>
<h2 id="problem-3">Problem 3</h2>
<p>You should now be able to add an adding a fourth constraint to the formulation of Problem 2.</p>
<div class="math">
\[
\begin{aligned}
\text{Obj:} \max(2y+x)
\\ \text{subject to:} \qquad x \leq 15
\\ \qquad \quad y \leq 8
\\ \quad x+y \leq 18
\\ -\frac{1}{3}x+y \leq 2
\end{aligned}
\]</div>
<p><img src="/posts/images/lp/A3.png" class="img-fluid" width="100%" alt="A3" /></p>
<p>The solver is initialized with the full problem 2 defintion already, x and y are already declared. When you click on the solver's cell, the solver.Solve() function is called and results are written out.</p>
<p><img src="/posts/images/lp/10-5.png" class="img-fluid" width="100%" alt="10-5.png" /></p>
<p>For those following along in the <a href="https://github.com/ewinnington/noteb/blob/master/IntroToLP.ipynb">notebook</a> there is a hint below this section with a second implementation of the <code>SolveProblem()</code> function which should give you hints based on your objective value.</p>
<h2 id="the-power-of-jupyter-special-commands">The power of Jupyter special commands</h2>
<p>I'm discovering slowly the jupyter commands. The first command <code>display()</code> allows you to present objects in a table. A great way to select the properties you want to show is to use linq (remember to add <code>using System.Linq</code>) to map a list of objects to an anonymous object with the properties you want to show in the table.</p>
<pre><code>display(solver.variables().Select(a =&gt; new { Name  = a.Name(), Value = a.SolutionValue() }));
</code></pre>
<p><img src="/posts/images/lp/10-6.png" class="img-fluid" width="100%" alt="10-6.png" /></p>
<h2 id="recap">Recap</h2>
<p>Now that we have introduced linear programming and know how to use the solver, the following chapter will cover two simple linear programming applications.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn:1">
<p>OR here refers to <a href="https://en.wikipedia.org/wiki/Operations_research">Operational Research</a> - the field of mathematics dedicated to the search for optimal or near optimal solutions to problems.<a href="#fnref:1" class="footnote-back-ref">&#8617;</a><a href="#fnref:2" class="footnote-back-ref">&#8617;</a></p>
</li>
<li id="fn:2">
<p>For those using <a href="/posts/Switching-to-wyam">Wyam to generate their blogs</a>, you can add the</p>
<pre><code class="language-HTML">&lt;script type=&quot;text/javascript&quot; id=&quot;MathJax-script&quot; async
src=&quot;https://cdn.jsdelivr.net/npm/mathjax&#64;3/es5/tex-mml-chtml.js&quot;&gt;
&lt;/script&gt;
</code></pre>
<p>to your <code>_Head.cshtml</code> template page. I recommend checking out <a href="https://www.mathjax.org/">MathJax</a> for the latest <a href="http://docs.mathjax.org/en/latest/web/start.html#using-mathjax-from-a-content-delivery-network-cdn">CDN</a>.<a href="#fnref:3" class="footnote-back-ref">&#8617;</a></p>
</li>
</ol>
</div>


<hr>
					</div>
				</div>
			</div>

			<!-- Footer -->
			<footer id="footer">
				<div class="inner">
    <section>
        <h2>Feeds</h2>
        <ul class="actions small vertical">
            <li><a href="/feed.rss" class="button small"><i class="fa fa-rss"></i> RSS Feed</a></li>
                        <li><a href="/feed.atom" class="button small"><i class="fa fa-rss"></i> Atom Feed</a></li>
        </ul>
    </section>
    <section>
    </section>
    <ul class="copyright">
        <li>Copyright © 2022</li>
        <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
        <li><a href="https://wyam.io">Generated by Wyam</a></li>
    </ul>
</div>

			</footer>

		</div>
		
		

		<!-- Scripts -->
		<script>hljs.initHighlightingOnLoad();</script>
		<script src="/assets/js/jquery.min.js"></script>
		<script src="/assets/js/skel.min.js"></script>
		<script src="/assets/js/util.js"></script>
		<!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
		<script src="/assets/js/main.js"></script>

	</body>

</html>
